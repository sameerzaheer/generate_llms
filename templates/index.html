<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>llms.txt generator</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            background-color: #f4f4f4;
            position: relative;
        }

        input[type="text"] {
            width: 60%;
            padding: 10px;
            font-size: 16px;
        }

        button {
            padding: 10px 20px;
            margin-left: 10px;
            font-size: 16px;
            cursor: pointer;
        }

        .section {
            margin-top: 30px;
            position: relative;
        }

        .section-title {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 5px;
            border-radius: 3px;
            transition: background-color 0.2s;
        }

        .section-title:hover {
            background-color: #f0f0f0;
        }

        .toggle-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            padding: 2px 6px;
            border-radius: 3px;
            transition: background-color 0.2s;
        }

        .toggle-btn:hover {
            background-color: #e0e0e0;
        }

        .section-content {
            display: none;
        }

        .section-content.expanded {
            display: block;
        }

        /* Tab Styles */
        .tab-container {
            margin-top: 30px;
        }

        .tab-buttons {
            display: flex;
            border-bottom: 2px solid #ddd;
            margin-bottom: 20px;
        }

        .tab-button {
            padding: 10px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
        }

        .tab-button.active {
            border-bottom-color: #3498db;
            color: #3498db;
            font-weight: bold;
        }

        .tab-button:hover {
            background-color: #f8f9fa;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Table Styles */
        .scheduled-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: white;
            border-radius: 5px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .scheduled-table th,
        .scheduled-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .scheduled-table th {
            background-color: #f8f9fa;
            font-weight: bold;
            color: #333;
        }

        .scheduled-table tr:hover {
            background-color: #f5f5f5;
        }

        .last-result-cell {
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .action-btn {
            padding: 6px 12px;
            margin: 2px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            transition: background-color 0.2s;
        }

        .copy-btn-table {
            background-color: #28a745;
            color: white;
        }

        .copy-btn-table:hover {
            background-color: #218838;
        }

        .delete-btn {
            background-color: #dc3545;
            color: white;
        }

        .delete-btn:hover {
            background-color: #c82333;
        }

        .output-box {
            width: 90%;
            height: 300px;
            border: 1px solid #ccc;
            padding: 10px;
            overflow-y: scroll;
            background-color: #fff;
            position: relative;
            border-radius: 5px;
        }

        .output-box.markdown {
            white-space: normal;
        }

        .output-box.markdown h1,
        .output-box.markdown h2,
        .output-box.markdown h3,
        .output-box.markdown h4,
        .output-box.markdown h5,
        .output-box.markdown h6 {
            margin-top: 10px;
            margin-bottom: 5px;
        }

        .output-box.markdown p {
            margin: 5px 0;
        }

        .output-box.markdown code {
            background-color: #f0f0f0;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: monospace;
        }

        .output-box.markdown pre {
            background-color: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }

        .copy-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px;
        }

        .copy-btn svg {
            width: 20px;
            height: 20px;
            fill: #555;
        }

        .copy-btn:hover svg {
            fill: #000;
        }

        /* Loading Spinner Styles */
        .spinner {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 9px solid #e3e3e3; /* grey */
            border-top: 9px solid #3498db; /* Blue */
            border-radius: 50%;
            width: 120px;
            height: 120px;
            animation: spin 1.5s linear infinite;
            z-index: 10;  /* Ensure spinner appears above other content */
        }

        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
    </style>
</head>
<body>

    <h1>llms.txt Generator</h1>

    <!-- Tab Container -->
    <div class="tab-container">
        <div class="tab-buttons">
            <button class="tab-button active" onclick="switchTab('generator')">Generator</button>
            <button class="tab-button" onclick="switchTab('scheduled')">Scheduled llms.txt</button>
        </div>

        <!-- Generator Tab -->
        <div id="generator-tab" class="tab-content active">
            <input type="text" id="urlInput" placeholder="Enter a URL">
            <button onclick="generateText()">Generate</button>
            <div style="margin-top: 10px;">
                <label style="margin-right: 20px;">
                    <input type="checkbox" id="scheduleUpdates"> Schedule updates
                </label>
                <label style="margin-right: 20px;">
                    <input type="checkbox" id="useLLM"> Use LLM
                </label>
                <label>
                    <input type="number" id="triggerInterval" value="70" min="10" max="3600" style="width: 60px; margin-left: 5px;" disabled> seconds
                </label>
                <label style="margin-left: 20px;">
                    <input type="number" id="maxPages" value="20" min="1" max="1000" style="width: 60px; margin-left: 5px;"> max pages
                </label>
            </div>
            <div style="margin-top: 15px; display: flex; gap: 20px;">
                <div style="flex: 1;">
                    <label for="avoidSubstrings" style="display: block; margin-bottom: 5px; font-weight: bold;">URL substrings to avoid crawling:</label>
                    <textarea id="avoidSubstrings" placeholder="Enter URL substrings to avoid (one per line)&#10;Example:&#10;/admin&#10;/private&#10;/temp" rows="4" style="width: 100%; font-family: monospace;"></textarea>
                </div>
                <div style="flex: 1;">
                    <label for="llmInstructions" style="display: block; margin-bottom: 5px; font-weight: bold;">LLM instructions:</label>
                    <textarea id="llmInstructions" placeholder="Emphasize our product offerings more so than careers, privacy policy etc." rows="4" style="width: 100%; font-family: Arial, sans-serif;" disabled></textarea>
                </div>
            </div>

            <!-- Spinner (hidden by default) -->
            <div id="spinner" class="spinner"></div>

            <!-- Output Section 1 -->
            <div class="section">
                <div class="section-title" onclick="toggleSection('section1')">
                    Generated llms.txt
                    <button class="toggle-btn" onclick="event.stopPropagation(); toggleSection('section1')">▼</button>
                </div>
                <div id="section1" class="section-content">
                    <button class="copy-btn" onclick="copyToClipboard('output1')" title="Copy to clipboard">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 18H8V7h11v16z"/>
                        </svg>
                    </button>
                    <div id="output1" class="output-box markdown"></div>
                </div>
            </div>

            <!-- Output Section 2 -->
            <div class="section">
                <div class="section-title" onclick="toggleSection('section2')">
                    Generated llms.txt (with LLM)
                    <button class="toggle-btn" onclick="event.stopPropagation(); toggleSection('section2')">▼</button>
                </div>
                <div id="section2" class="section-content">
                    <button class="copy-btn" onclick="copyToClipboard('output3')" title="Copy to clipboard">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 18H8V7h11v16z"/>
                        </svg>
                    </button>
                    <div id="output3" class="output-box markdown"></div>
                </div>
            </div>

            <!-- Output Section 3 -->
            <div class="section">
                <div class="section-title" onclick="toggleSection('section3')">
                    llms.txt generated by firecrawl
                    <button class="toggle-btn" onclick="event.stopPropagation(); toggleSection('section3')">▼</button>
                </div>
                <div id="section3" class="section-content">
                    <button class="copy-btn" onclick="copyToClipboard('output2')" title="Copy to clipboard">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 18H8V7h11v16z"/>
                        </svg>
                    </button>
                    <div id="output2" class="output-box markdown"></div>
                </div>
            </div>
        </div>

        <!-- Scheduled Tab -->
        <div id="scheduled-tab" class="tab-content">
            <button onclick="loadScheduledTasks()" style="margin-bottom: 20px;">Refresh Tasks</button>
            <table class="scheduled-table">
                <thead>
                    <tr>
                        <th>Task ID</th>
                        <th>Base URL</th>
                        <th>Time Created</th>
                        <th>Time Last Run</th>
                        <th>Last Status</th>
                        <th>Last Result</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="scheduled-tbody">
                    <!-- Data will be populated here -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Global variables to store the generated data
        let currentData = { output1: '', output2: '', output3: '' };
        let scheduledTasksData = []; // Store scheduled tasks data

        // Initialize checkbox functionality when page loads
        document.addEventListener('DOMContentLoaded', function() {
            const scheduleUpdatesCheckbox = document.getElementById('scheduleUpdates');
            const useLLMCheckbox = document.getElementById('useLLM');
            const triggerIntervalInput = document.getElementById('triggerInterval');
            const maxPagesInput = document.getElementById('maxPages');
            const llmInstructionsTextarea = document.getElementById('llmInstructions');
            
            // Schedule updates checkbox functionality
            scheduleUpdatesCheckbox.addEventListener('change', function() {
                console.log('Schedule updates checkbox changed - checked:', this.checked);
                triggerIntervalInput.disabled = !this.checked;
                console.log('Trigger interval disabled:', triggerIntervalInput.disabled);
            });
            
            // LLM checkbox functionality
            useLLMCheckbox.addEventListener('change', function() {
                console.log('LLM checkbox changed - checked:', this.checked);
                llmInstructionsTextarea.disabled = !this.checked;
                console.log('Textarea disabled:', llmInstructionsTextarea.disabled);
            });
        });

        function generateText() {
            const url = document.getElementById('urlInput').value;
            const scheduleUpdates = document.getElementById('scheduleUpdates').checked;
            const avoidSubstrings = document.getElementById('avoidSubstrings').value;
            const useLLM = document.getElementById('useLLM').checked;
            const llmInstructions = document.getElementById('llmInstructions').value;
            const triggerInterval = parseInt(document.getElementById('triggerInterval').value) || 70;
            const maxPages = parseInt(document.getElementById('maxPages').value) || 20;

            // Show spinner
            document.getElementById('spinner').style.display = 'block';

            // Fetch the generated data
            fetch('/generate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    url: url,
                    scheduleUpdates: scheduleUpdates,
                    avoidSubstrings: avoidSubstrings,
                    useLLM: useLLM,
                    llmInstructions: llmInstructions,
                    triggerInterval: triggerInterval,
                    maxPages: maxPages
                })
            })
            .then(response => response.json())
            .then(data => {
                // Hide spinner once data is fetched
                document.getElementById('spinner').style.display = 'none';

                // Store the data globally
                currentData = data;

                // Update the output boxes
                document.getElementById('output1').innerHTML = marked.parse(data.output1);
                document.getElementById('output2').innerHTML = marked.parse(data.output2);
                document.getElementById('output3').innerHTML = marked.parse(data.output3 || '');
            })
            .catch(error => {
                document.getElementById('spinner').style.display = 'none';
                alert("Error generating content: " + error);
            });
        }

        function copyToClipboard(elementId) {
            let text;
            if (elementId === 'output1') {
                text = currentData.output1;
            } else if (elementId === 'output2') {
                text = currentData.output2;
            } else if (elementId === 'output3') {
                text = currentData.output3 || '';
            } else {
                text = document.getElementById(elementId).textContent;
            }
            navigator.clipboard.writeText(text).then(() => {
                alert("Copied to clipboard!");
            }).catch(err => {
                alert("Failed to copy: " + err);
            });
        }

        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            const toggleBtn = section.previousElementSibling.querySelector('.toggle-btn');
            
            if (section.classList.contains('expanded')) {
                section.classList.remove('expanded');
                toggleBtn.textContent = '▼';
            } else {
                section.classList.add('expanded');
                toggleBtn.textContent = '▲';
            }
        }

        function switchTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.classList.remove('active'));
            
            // Remove active class from all tab buttons
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => button.classList.remove('active'));
            
            // Show selected tab content
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
            
            // Load scheduled tasks if switching to scheduled tab
            if (tabName === 'scheduled') {
                loadScheduledTasks();
            }
        }

        function loadScheduledTasks() {
            fetch('/scheduled-tasks')
                .then(response => response.json())
                .then(data => {
                    // Store the data globally
                    scheduledTasksData = data;
                    
                    const tbody = document.getElementById('scheduled-tbody');
                    tbody.innerHTML = '';
                    
                    data.forEach(task => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${task.task_id}</td>
                            <td>${task.base_url}</td>
                            <td>${task.time_created}</td>
                            <td>${task.time_last_run || 'Never'}</td>
                            <td>${task.last_status || 'N/A'}</td>
                            <td class="last-result-cell" title="${task.last_result || ''}">${task.last_result || 'N/A'}</td>
                            <td>
                                <button class="action-btn copy-btn-table" onclick="copyTaskResult('${task.task_id}')">Copy Result</button>
                                <button class="action-btn delete-btn" onclick="deleteTask('${task.task_id}')">Delete</button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                })
                .catch(error => {
                    console.error('Error loading scheduled tasks:', error);
                    document.getElementById('scheduled-tbody').innerHTML = '<tr><td colspan="7">Error loading tasks</td></tr>';
                });
        }

        function copyTaskResult(taskId) {
            // Find the task in the scheduled tasks data
            const task = scheduledTasksData.find(t => t.task_id === taskId);
            
            if (task && task.last_result && task.last_result !== 'N/A') {
                navigator.clipboard.writeText(task.last_result).then(() => {
                    alert("Task result copied to clipboard!");
                }).catch(err => {
                    console.error("Copy error:", err);
                    alert("Failed to copy: " + err);
                });
            } else {
                alert("No result to copy");
            }
        }



        function deleteTask(taskId) {
            if (confirm('Are you sure you want to delete this task?')) {
                fetch(`/delete/${taskId}`, {
                    method: 'POST'
                })
                .then(response => {
                    if (response.ok) {
                        alert('Task deleted successfully!');
                        loadScheduledTasks(); // Refresh the table
                    } else {
                        alert('Failed to delete task');
                    }
                })
                .catch(error => {
                    console.error('Error deleting task:', error);
                    alert('Error deleting task: ' + error);
                });
            }
        }
    </script>

</body>
</html>
